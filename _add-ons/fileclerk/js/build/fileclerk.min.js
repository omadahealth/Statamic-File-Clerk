!function(){for(var e,i=function(){},l=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],s=l.length,t=window.console=window.console||{};s--;)e=l[s],t[e]||(t[e]=i)}(),$.fn.toggleAttr=function(e,i){return i?this.attr(e,e):"undefined"!=typeof i?this.removeAttr(e):this.each(function(){var i=$(this);"undefined"==typeof i.attr(e)?i.attr(e,e):i.removeAttr(e)})},$(function(){var e={lines:13,length:6,width:2,radius:6,corners:1,hwaccel:!0},i={init:function(){this.bindUIActions()},bindUIActions:function(){$("body").on("change",".file-upload",this.uploadFiles),$("body").on("click",".btn-remove",this.removeFileReference),$("body").on("click",".load_existing",this.loadExisting),$("body").on("doubletap",".is-directory",this.loadExisting),$("body").on("click",".breadcrumb a, .error-no-results a[data-uri]",this.loadExisting),$("body").on("tap",".view-list td",this.highlightRow),$("body").on("tap",".view-list td a",this.preventHighlightRow),$("body").on("click",'[data-action="select_file"]',this.selectFile),$("body").on("click",'[data-action="go-back"]',this.goBack)},prepareUpload:function(e){var i=e.target.files,l=$(this).closest(".fileclerk").find(".btn-upload");l.removeClass("is-hidden"),console.log(i)},fileCheck:function(e,i){$.ajax({url:"/TRIGGER/fileclerk/filecheck",type:"GET",data:{destination:e,filename:i},cache:!1,dataType:"JSON",processData:!0,contentType:!1,success:function(e){if(700===e.code);else if(300===e.code)return console.log(e),e.error},error:function(){return!1}})},uploadFiles:function(e){e.preventDefault();var l=$(this),s=l.closest(".fileclerk"),t=l.val(),n=t.split("\\"),a=n[n.length-1],o=l.closest(".view-upload"),d=o.find(".postUrl").val(),r=o.find(".postUrl").data("destination"),c=o.find(".file-wrapper"),f=o.find(".progress-bar"),v=f.find("progress"),h=f.find(".prc"),u=s.find(".result .filename-display .filename"),p=s.find(".result input.successful-upload"),g=s.find(".result"),b=s.find(".add-file"),m=b.find(".nav-tabs li:nth-child(2) a"),C=s.find(".upload-error"),w=s.find(".preview"),k=s.find(".inline-preview .load img"),y=s.find(".result input.hidden-url"),x=s.find(".result input.hidden-filename"),R=s.find(".result input.hidden-extension"),E=s.find(".result input.hidden-size"),T=s.find(".result input.hidden-size-bytes"),D=s.find(".result input.hidden-size-kilobytes"),z=s.find(".result input.hidden-size-megabytes"),I=s.find(".result input.hidden-size-gigabytes"),j=s.find(".result input.hidden-is-image");if(""!==a){var S=new FormData;$.each(l[0].files,function(e,i){S.append("file-"+e,i)});var U=function(e){"undefined"!=typeof e&&(d=d+"&overwrite="+e),$.ajax({url:d,type:"POST",data:S,cache:!1,dataType:"JSON",xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){var i=parseInt(e.loaded/e.total*100);console.log("Uploading: ",e.loaded/e.total*100+"%"),v.attr({value:e.loaded,max:e.total}),h.html(i+"%")},e.upload.onload=function(){console.log("DONE!")},e},processData:!1,contentType:!1,beforeSend:function(){c.removeClass("is-visible").addClass("is-hidden"),f.toggleClass("is-hidden is-visible")},success:function(e){100===e.code?(console.log(e.success),console.log("URL: "+e.data.fullpath),f.toggleClass("is-visible is-hidden"),u.append(e.data.filename),p.val(e.data.fullpath),u.attr("href",e.data.fullpath),b.toggleClass("is-visible is-hidden"),g.toggleClass("is-hidden is-visible"),s.addClass("yay"),w.removeClass("is-hidden").addClass("is-visible"),y.val(e.data.fullpath),x.val(e.data.filename),R.val(e.data.extension),E.val(e.data.size),T.val(e.data.size_bytes),D.val(e.data.size_kilobytes),z.val(e.data.size_megabytes),I.val(e.data.size_gigabytes),j.val(e.data.is_image),w.attr("href",e.data.fullpath),k.attr("src",""),"true"===j.val()||"1"===j.val()?(w.unbind(),w.attr("rel","inline")):(w.unbind(),w.attr("rel","external"))):200===e.code||(300===e.code?(console.log(e.message),C.toggleClass("is-hidden is-visible").html(e.html),f.toggleClass("is-visible is-hidden"),l.closest(".fileclerk").find(".upload-error .error-exists a").on("click",function(e){var i=$(this).attr("data-action");"replace"===i&&(console.log("Replace"),U(!0),C.toggleClass("is-visible is-hidden")),"keep-both"===i&&(console.log("Keep Both"),U(!1),C.toggleClass("is-visible is-hidden")),"cancel"===i&&(console.log("Cancel"),C.toggleClass("is-visible is-hidden"),c.removeClass("is-hidden").addClass("is-visible")),e.preventDefault()})):700===e.code?(console.log(e.message),C.toggleClass("is-hidden is-visible").html(e.html),f.toggleClass("is-visible is-hidden"),l.closest(".fileclerk").find(".upload-error .error-not-allowed a").on("click",function(e){var i=$(this).attr("data-action");"cancel"===i&&(console.log("Cancel"),C.toggleClass("is-visible is-hidden"),c.toggleClass("is-hidden is-visible")),e.preventDefault()})):console.log("ERRORS: "+e.error))},error:function(e,i){console.log("ERRORS: "+i)}})},A=function(){$.ajax({url:"/TRIGGER/fileclerk/filecheck",type:"GET",data:{destination:r,filename:a},cache:!1,dataType:"JSON",processData:!0,contentType:!1,async:!1,beforeSend:function(){},success:function(i){300===i.code?(e.preventDefault(),console.log(i),console.log(i.message),c.toggleClass("is-visible is-hidden"),C.toggleClass("is-hidden is-visible").html(i.html),m.removeAttr("data-toggle").addClass("disabled"),l.closest(".fileclerk").find(".upload-error .error-exists a").on("click",function(e){var i=$(this).attr("data-action");console.log(i),"replace"===i&&(console.log("Replace"),U(!0),C.toggleClass("is-visible is-hidden")),"keep-both"===i&&(console.log("Keep Both"),U(!1),C.toggleClass("is-visible is-hidden")),"cancel"===i&&(console.log("Cancel"),C.toggleClass("is-visible is-hidden"),c.toggleClass("is-hidden is-visible")),m.attr("data-toggle","tab").removeClass("disabled"),e.preventDefault()})):700===i.code?(console.log(i.message),c.removeClass("is-visible").addClass("is-hidden"),C.toggleClass("is-hidden is-visible").html(i.html),l.closest(".fileclerk").find(".upload-error .error-not-allowed a").on("click",function(e){var i=$(this).attr("data-action");"cancel"===i&&(console.log("Cancel"),C.toggleClass("is-visible is-hidden"),c.toggleClass("is-hidden is-visible")),e.preventDefault()})):800===i.code&&U(!1)},error:function(e,i,l){return console.log(l.stack),!1}})};A(),i.resetFormElement(l)}},resetFormElement:function(e){e.wrap("<form>").parent("form").trigger("reset"),e.unwrap()},removeFileReference:function(e){var i=$(this),l=i.closest(".fileclerk"),s=i.closest(".fileclerk").find(".result"),t=i.closest(".fileclerk").find(".add-file"),n=i.closest(".fileclerk").find(".result input.successful-upload"),a=i.closest(".fileclerk").find('.result input[type="hidden"]'),o=i.closest(".fileclerk").find(".result .filename-display .filename"),d=i.closest(".fileclerk").find(".file-wrapper");e.preventDefault(),n.val(""),a.val(""),o.html(""),s.toggleClass("is-visible is-hidden"),setTimeout(function(){t.toggleClass("is-hidden is-visible"),d.removeClass("is-hidden").addClass("is-visible"),l.removeClass("yay")},300)},loadExisting:function(i){i.preventDefault();var l=$(this),s="/TRIGGER/fileclerk/list"+($(this).data("uri")?"?uri="+$(this).data("uri"):"")+($(this).data("uri")?"&":"?")+($(this).data("destination")?"destination="+$(this).data("destination"):""),t=l.closest(".add-file").find(".view-remote .view-list"),n=t.find("table"),a=t.find("tbody"),o=t.find(".error-no-results"),d=l.closest(".add-file").find(".view-remote .breadcrumb"),r=l.closest(".add-file").find(".view-remote .ajax-spinner"),c=l.closest(".add-file").find(".view-remote .ajax-overlay");$.ajax({url:s,type:"GET",cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){r.spin(e),c.toggleClass("is-hidden is-visible")},success:function(e){400===e.code||e.error===!1?(console.log(e.success),o.remove(),d.html(e.breadcrumb),n.removeClass("is-hidden"),a.html(e.html),r.spin(!1),c.toggleClass("is-visible is-hidden")):500===e.code?(d.html(e.breadcrumb),o.remove(),$(e.html).prependTo(t),n.addClass("is-hidden"),a.empty(),r.spin(!1),c.toggleClass("is-visible is-hidden")):600===e.code},error:function(e,i){console.log("ERRORS: "+i)}})},highlightRow:function(){var e=$(this),i="is-highlighted",l=e.closest("tr").siblings(),s=e.parent("tr"),t=e.closest("tbody").find("tr"),n=e.closest(".view-remote").find('button[data-action="select_file"]');l.removeClass(i),s.toggleClass(i),t.hasClass(i)&&!s.hasClass("directory")?n.prop("disabled",!1):n.prop("disabled",!0)},preventHighlightRow:function(e){e.stopPropagation()},selectFile:function(e){e.preventDefault();var i=$(this),l=i.closest(".fileclerk"),s=i.closest(".view-remote"),t=s.find(".view-list table tr.file.is-highlighted").data("file"),n=s.find(".view-list table tr.file.is-highlighted td.is-file .filename").html(),a=s.find(".view-list table tr.file.is-highlighted").data("extension"),o=s.find(".view-list table tr.file.is-highlighted").data("is-image"),d=s.find(".view-list table tr.file.is-highlighted").data("size"),r=s.find(".view-list table tr.file.is-highlighted").data("size-bytes"),c=s.find(".view-list table tr.file.is-highlighted").data("size-kilobytes"),f=s.find(".view-list table tr.file.is-highlighted").data("size-megabytes"),v=s.find(".view-list table tr.file.is-highlighted").data("size-gigabytes"),h=l.find(".result .filename-display .filename"),u=l.find(".result input.successful-upload"),p=l.find(".result"),g=l.find(".add-file"),b=l.find(".preview"),m=l.find(".inline-preview .load img"),C=l.find(".result input.hidden-url"),w=l.find(".result input.hidden-filename"),k=l.find(".result input.hidden-extension"),y=l.find(".result input.hidden-size"),x=l.find(".result input.hidden-size-bytes"),R=l.find(".result input.hidden-size-kilobytes"),E=l.find(".result input.hidden-size-megabytes"),T=l.find(".result input.hidden-size-gigabytes"),D=l.find(".result input.hidden-is-image");h.append(n),u.val(t),C.val(t),w.val(n),k.val(a),D.val(o),y.val(d),x.val(r),R.val(c),E.val(f),T.val(v),h.attr("href",t),b.removeClass("is-hidden").addClass("is-visible"),g.toggleClass("is-visible is-hidden"),p.toggleClass("is-hidden is-visible"),l.addClass("yay"),b.attr("href",t),m.attr("src",""),"true"===D.val()||"1"===D.val()?(b.unbind(),b.attr("rel","inline")):(b.unbind(),b.attr("rel","external")),console.log(n+" selected")},fileExists:function(e){var i=$(this),l=i.attr("data-action"),s=i.closest(".fileclerk").find(".upload-error"),t=i.closest(".fileclerk").find(".upload-error .error-exists"),n=i.closest(".fileclerk").find(".file-wrapper");"replace"===l&&console.log("Replace"),"keep-both"===l&&console.log("Keep Both"),"cancel"===l&&(console.log("Cancel"),t.remove(),s.toggleClass("is-visible is-hidden"),n.toggleClass("is-hidden is-visible")),e.preventDefault()},goBack:function(e){var i=$(this),l=i.closest(".error-no-results"),s=i.closest(".fileclerk").find(".nav-tabs li:nth-child(1) a").attr("href");$('a[href="'+s+'"]').tab("show"),l.remove(),e.preventDefault()}};i.init();var l=function(e){var i="^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{2,4})\\s*(\\d{1,2}):(\\d{1,2})\\s*(am|pm|AM|PM|Am|Pm)$",l=new RegExp(i);if(l.test(e)){var s=l.exec(e).slice(1),t=s[0],n=s[1],a=s[2],o=s[3],d=s[4],r=s[5],c=t+" "+n+" "+a+" "+o+":"+d+":00 "+r;return new Date(c)}return!1},s=function(e){var i=e.split(" "),l=i[0].replace(/,/g,""),s=i[1],t=8;return"KB"===s?t=1024:"MB"===s?t=1048576:"GB"===s&&(t=1073741824),parseInt(l*t,10)};$(".tablesort").stupidtable({date:function(e,i){var s=l(e),t=l(i);return s-t},size:function(e,i){var l=s(e),t=s(i);return l-t}});var t={init:function(){this.bindUIActions()},bindUIActions:function(){$("body").on("click",'.fileclerk a.preview[rel="inline"]',this.showInlinePreview),$("body").on("click",".fileclerk .inline-preview .modal-close",this.hideInlinePreview),$(document).keyup(function(e){if(27===e.keyCode){var i=$(".fileclerk .inline-preview"),l=$(".fileclerk .preview"),s=$(".fileclerk .view-remote .ajax-overlay.is-visible"),t=$(".fileclerk").find(".inline-preview.is-visible .load");i.removeClass("is-visible").addClass("is-hidden"),l.removeClass("active"),s.toggleClass("is-visible is-hidden"),t.html("")}}),$(document).on("click",function(e){if(!$(e.target).closest(".fileclerk .inline-preview").length){var i=$(".fileclerk .inline-preview"),l=$(".fileclerk .preview"),s=$(e.target).closest(".fileclerk .view-remote .ajax-overlay.is-visible"),t=$(".fileclerk").find(".inline-preview.is-visible .load");i.removeClass("is-visible").addClass("is-hidden"),l.removeClass("active"),s.toggleClass("is-visible is-hidden"),t.html("")}})},showInlinePreview:function(i){var l=$(this),s=l.attr("href"),t=$(".fileclerk .inline-preview"),n=$(".fileclerk .result .preview"),a=$("html, body"),o=l.closest(".fileclerk"),d=o.find(".inline-preview .load"),r=o.find(".result .inline-preview"),c=o.find(".inline-preview .load .ajax-spinner"),f=l.closest("tr.file"),v=$(".fileclerk").find(".view-remote .inline-preview .load"),h=$(".fileclerk").find(".view-remote .inline-preview"),u=f.find(".inline-preview .load .ajax-spinner"),p=l.closest(".fileclerk").find("table.tablesort"),g=l.closest(".fileclerk").find(".view-remote .ajax-overlay");t.removeClass("is-visible").addClass("is-hidden"),n.removeClass("active"),l.hasClass("preview--is-selected")&&(r.toggleClass("is-hidden is-visible"),l.addClass("active"),a.animate({scrollTop:r.offset().top-20},500),$.ajax({url:"/TRIGGER/fileclerk/ajaxpreview?url="+s,cache:!1,dataType:"JSON",beforeSend:function(){c.spin(e)},success:function(e){d.html('<img src="'+e.url+'">'),console.log(e),c.spin(!1)}})),l.hasClass("preview--choose-existing")&&(h.toggleClass("is-hidden is-visible"),l.addClass("active"),p.animate({scrollTop:h.offset().top-20},500),$.ajax({url:"/TRIGGER/fileclerk/ajaxpreview?url="+s,cache:!1,dataType:"JSON",beforeSend:function(){u.spin(e),g.toggleClass("is-hidden is-visible")},success:function(e){v.html('<img src="'+e.url+'">'),console.log(e),u.spin(!1)}})),i.preventDefault(),i.stopPropagation()},hideInlinePreview:function(e){var i=$(this),l=i.closest(".fileclerk"),s=l.find(".inline-preview.is-visible"),t=l.find(".inline-preview.is-visible .load"),n=l.find(".preview.active"),a=l.find(".view-remote .ajax-overlay");s.toggleClass("is-visible is-hidden"),t.html(""),n.removeClass("active"),a.toggleClass("is-visible is-hidden"),e.preventDefault(),e.stopPropagation()}};t.init();var n={init:function(){this.bindUIActions()},bindUIActions:function(){$("body").on("click",'.fileclerk a[rel="external"]',this.previewExternal)},previewExternal:function(e){e.preventDefault(),e.stopPropagation(),window.open(this.href,"_blank")}};n.init();var a={init:function(){this.bindUIActions()},bindUIActions:function(){$("body").on("click",'.fileclerk .nav-tabs a[data-tab="nav-upload"]',this.showUploadContainer),$("body").on("click",'.fileclerk .nav-tabs a[data-tab="nav-choose"]',this.showChooseContainer)},showUploadContainer:function(e){var i=$(this),l=i.closest(".fileclerk"),s=l.find(".nav-tabs li"),t=i.parent("li"),n=l.find(".tab-pane"),a=l.find(".tab-pane.view-upload");s.removeClass("active"),t.addClass("active"),n.removeClass("active"),a.addClass("active fade in"),e.preventDefault(),e.stopPropagation()},showChooseContainer:function(e){var i=$(this),l=i.closest(".fileclerk"),s=l.find(".nav-tabs li"),t=i.parent("li"),n=l.find(".tab-pane"),a=l.find(".tab-pane.view-remote");s.removeClass("active"),t.addClass("active"),n.removeClass("active"),a.addClass("active fade in"),e.preventDefault(),e.stopPropagation()}};a.init()});