$(function(){var a={init:function(){this.bindUIActions()},bindUIActions:function(){$("body").on("change",".file-upload",this.uploadFiles),$("body").on("click",".btn-remove",this.removeFileReference),$("body").on("click",".load_existing",this.loadExisting),$("body").on("dblclick",".is-directory",this.loadExisting),$("body").on("click",".breadcrumb a",this.loadExisting),$("body").on("click",".view-list td",this.highlightRow)},prepareUpload:function(a){var b=a.target.files,c=$(this).closest(".s3files").find(".btn-upload");c.removeClass("is-hidden"),console.log(b)},uploadFiles:function(){var b=$(this),c=b.val(),d=c.split("\\"),e=d[d.length-1],f=b.closest(".view-upload"),g=f.find(".postUrl").val(),h=f.find(".file-wrapper"),i=f.find(".progress-bar"),j=i.find("progress"),k=i.find(".prc"),l=b.closest(".s3files").find(".result .filename-display"),m=b.closest(".s3files").find(".result input.successful-upload"),n=b.closest(".s3files").find(".result"),o=b.closest(".s3files").find(".s3-add-file"),p=b.closest(".s3files").find(".upload-error");if(""!==e){var q=new FormData;$.each(b[0].files,function(a,b){q.append("file-"+a,b)});var r=function(a){"undefined"!=typeof a&&(g=g+"&overwrite="+a),$.ajax({url:g,type:"POST",data:q,cache:!1,dataType:"JSON",xhr:function(){var a=$.ajaxSettings.xhr();return a.upload&&(console.log("Xhr"),a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=parseInt(a.loaded/a.total*100,10);console.log(b+"%"),j.attr({value:a.loaded,max:a.total}),k.html(b+"%")}},!1)),a},processData:!1,contentType:!1,beforeSend:function(){h.addClass("is-hidden"),i.removeClass("is-hidden")},success:function(a){100===a.code?(console.log(a.success),console.log("URL: "+a.data.fullpath),i.addClass("is-hidden"),l.append(a.data.filename),m.val(a.data.fullpath),o.toggleClass("is-visible is-hidden"),setTimeout(function(){n.toggleClass("is-hidden is-visible")},300)):200===a.code||(300===a.code?(console.log(a.message),p.toggleClass("is-hidden is-visible").html(a.html),i.toggleClass("is-visible is-hidden"),b.closest(".s3files").find(".upload-error .error-exists a").on("click",function(a){var b=$(this).attr("data-action");"replace"===b&&(console.log("Replace"),r(!0)),"keep-both"===b&&(console.log("Keep Both"),r(!1)),"cancel"===b&&(console.log("Cancel"),p.toggleClass("is-visible is-hidden"),h.toggleClass("is-hidden is-visible")),a.preventDefault()})):console.log("ERRORS: "+a.error))},error:function(a,b){console.log("ERRORS: "+b)}})};r(),a.resetFormElement(b),console.log("Uploading... "+e)}},resetFormElement:function(a){a.wrap("<form>").parent("form").trigger("reset"),a.unwrap()},removeFileReference:function(a){var b=$(this),c=b.closest(".s3files").find(".result"),d=b.closest(".s3files").find(".s3-add-file"),e=b.closest(".s3files").find(".result input.successful-upload"),f=b.closest(".s3files").find(".result .filename-display");a.preventDefault(),e.val(""),f.html(""),c.toggleClass("is-visible is-hidden"),setTimeout(function(){d.toggleClass("is-hidden is-visible")},300)},loadExisting:function(a){a.preventDefault();var b=$(this),c="/TRIGGER/s3files/list"+($(this).data("uri")?"?uri="+$(this).data("uri"):"")+($(this).data("uri")?"&":"?")+($(this).data("destination")?"destination="+$(this).data("destination"):""),d=b.closest(".s3-add-file").find(".view-remote .view-list tbody"),e=b.closest(".s3-add-file").find(".view-remote .breadcrumb"),f=b.closest(".s3-add-file").find(".view-remote .view-list .ajax-spinner"),g=b.closest(".s3-add-file").find(".view-remote .view-list .ajax-overlay");$.ajax({url:c,type:"GET",cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){f.spin({lines:10,length:6,width:2,radius:6,corners:0,hwaccel:!0,top:"165px"}),g.toggleClass("is-hidden is-visible")},success:function(a){400===a.code||a.error===!1?(console.log(a.success),e.html(a.breadcrumb),d.html(a.html),f.spin(!1),g.toggleClass("is-visible is-hidden")):500===a.code||600===a.code},error:function(a,b){console.log("ERRORS: "+b)}})},highlightRow:function(){var a=$(this),b="is-highlighted";a.closest("tr").siblings().removeClass(b),a.parent("tr").toggleClass(b)},fileExists:function(a){var b=$(this),c=b.attr("data-action"),d=b.closest(".s3files").find(".upload-error"),e=b.closest(".s3files").find(".upload-error .error-exists"),f=b.closest(".s3files").find(".file-wrapper");"replace"===c&&console.log("Replace"),"keep-both"===c&&console.log("Keep Both"),"cancel"===c&&(console.log("Cancel"),e.remove(),d.toggleClass("is-visible is-hidden"),f.toggleClass("is-hidden is-visible")),a.preventDefault()}};a.init()});