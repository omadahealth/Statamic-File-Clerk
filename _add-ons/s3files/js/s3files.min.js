/*! =========================================================
 * s3-files v0.0.1
 * A simple Amazon S3 add-on for Statamic
 * http://chadjclark.com
 * =========================================================
 * Copyright (c) 2014 Chad Clark, Brandon Haslip, and Michael Reiner
 *
 * This file built on 2014-03-17
 * ========================================================= */
!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),$(function(){var a={init:function(){this.bindUIActions()},bindUIActions:function(){$("body").on("change",".file-upload",this.prepareUpload),$("body").on("click",".btn-upload",this.uploadFiles),$("body").on("click",".btn-remove",this.removeFileReference)},prepareUpload:function(a){var b=a.target.files;btnUpload=$(this).closest(".s3files").find(".btn-upload"),btnUpload.removeClass("is-hidden"),console.log(b)},uploadFiles:function(b){b.stopPropagation(),b.preventDefault();var c=$(this).closest(".s3files").find(".file-upload"),d=$(this).closest(".s3files").find(".postUrl").val(),e=$(this).closest(".s3files").find(".fileinput"),f=$(this).closest(".s3files").find(".progress"),g=$(this).closest(".s3files").find(".progress-filename p"),h=$(this).closest(".s3files").find(".progress-bar"),i=$(this).closest(".s3files").find(".progress-bar progress.uploading"),j=$(this).closest(".s3files").find(".progress-bar .prc"),k=$(this).closest(".s3files").find(".result input.successful-upload"),l=new FormData;$.each(c[0].files,function(a,b){l.append("file-"+a,b)}),$.ajax({url:d,type:"POST",data:l,cache:!1,dataType:"JSON",xhr:function(){var a=$.ajaxSettings.xhr();return a.upload&&(console.log("Xhr"),a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=parseInt(a.loaded/a.total*100,10);console.log(b+"%"),i.attr({value:a.loaded,max:a.total}),j.html(b+"%")}},!1)),a},processData:!1,contentType:!1,beforeSend:function(){e.addClass("is-hidden"),f.removeClass("is-hidden").addClass("is-visible")},success:function(a){"undefined"==typeof a.error?(console.log(a.success),console.log("URL: "+a.fullpath),f.removeClass("uploading"),g.html('<div class="success"><strong>'+a.filename+'</strong><a class="remove" href="#">Remove</a></div>'),h.addClass("is-hidden"),k.val(a.fullpath)):console.log("ERRORS: "+a.error)},error:function(a,b){console.log("ERRORS: "+b)}}),a.resetFormElement(c),console.log("Uploading..."+c.attr("id"))},resetFormElement:function(a){a.wrap("<form>").parent("form").trigger("reset"),a.unwrap()},removeFileReference:function(a){var b=$(this).closest(".s3files").find(".result input.successful-upload"),c=$(this).closest(".s3files").find(".result .filename-display");a.preventDefault(),b.val(""),c.html("")}};a.init()});